<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Gin Basics</title>
      <link href="/2020/07/13/Gin-Basics/"/>
      <url>/2020/07/13/Gin-Basics/</url>
      
        <content type="html"><![CDATA[<h2 id="Installation-and-Quick-Start"><a href="#Installation-and-Quick-Start" class="headerlink" title="Installation and Quick Start"></a>Installation and Quick Start</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p <span class="variable">$GOPATH</span>/src/github.com/myusername/project &amp;&amp; <span class="built_in">cd</span> <span class="string">"<span class="variable">$_</span>"</span></span><br><span class="line">$ go mod init</span><br><span class="line">$ go get -v github.com/gin-gonic/gin</span><br><span class="line">(-v stands <span class="keyword">for</span> verbose)</span><br></pre></td></tr></table></figure><blockquote><p>If you are using GoLand, you’ll need to enable <code>Go Modules integration</code> in settings.</p></blockquote><p><code>project/start/main.go</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/ping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run() <span class="comment">// listen and serve on 0.0.0.0:8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cd</code> into start folder type <code>go run main.go</code> to run your file.</p><h2 id="Request-Routing"><a href="#Request-Routing" class="headerlink" title="Request Routing"></a>Request Routing</h2><blockquote><p>Request routing is essentially matching up <strong>urls</strong> with <strong>resources</strong>.</p></blockquote><h4 id="HTTP-Request-Types"><a href="#HTTP-Request-Types" class="headerlink" title="HTTP Request Types"></a>HTTP Request Types</h4><p><code>project/router_types/main.go</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/get"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"get"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.POST(<span class="string">"/post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"post"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">  <span class="comment">//r.DELETE("/delete", func(c *gin.Context) &#123;        // r.DELETE(...) is a shortcut for r.Handle("DELETE", ...)</span></span><br><span class="line"><span class="comment">//c.String(200, "delete")</span></span><br><span class="line"><span class="comment">//&#125;)</span></span><br><span class="line">r.Handle(<span class="string">"DELETE"</span>, <span class="string">"/delete"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"delete"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.Any(<span class="string">"/any"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;                <span class="comment">// Any function matches all 8 types of requests</span></span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"any"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Serving-Static-Files"><a href="#Serving-Static-Files" class="headerlink" title="Serving Static Files"></a>Serving Static Files</h4><p><code>project/router_static/assets/test.html</code></p><p><code>project/router_static/assets/test.html</code></p><p><code>project/router_static/main.go</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.Static(<span class="string">"/assets"</span>, <span class="string">"./assets"</span>)  <span class="comment">// for a directory, use default FileSystem: gin.Dir()</span></span><br><span class="line">r.StaticFS(<span class="string">"/static"</span>, http.Dir(<span class="string">"static"</span>)) <span class="comment">// for a custom http.FileSystem</span></span><br><span class="line">r.StaticFile(<span class="string">"/favicon.ico"</span>, <span class="string">"./favicon.ico"</span>) <span class="comment">// for a single file</span></span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go build -o router_static &amp;&amp; .&#x2F;router_static</span><br></pre></td></tr></table></figure><h4 id="Variables-in-URLs"><a href="#Variables-in-URLs" class="headerlink" title="Variables in URLs"></a>Variables in URLs</h4><p><code>project/router_uri/main.go</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/:name/:id"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">"name"</span>: c.Param(<span class="string">"name"</span>),</span><br><span class="line"><span class="string">"id"</span>: c.Param(<span class="string">"id"</span>),</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Generic-URL-Matching"><a href="#Generic-URL-Matching" class="headerlink" title="Generic URL Matching"></a>Generic URL Matching</h4><p><code>project/router_generic/main.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/user/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"Hello World!"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Request-Parameters"><a href="#Request-Parameters" class="headerlink" title="Request Parameters"></a>Request Parameters</h2><h4 id="GET-Request-Parameters"><a href="#GET-Request-Parameters" class="headerlink" title="GET Request Parameters"></a>GET Request Parameters</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">fristName := c.Query(<span class="string">"first_name"</span>)</span><br><span class="line">lastName := c.DefaultQuery(<span class="string">"last_name"</span>, <span class="string">"default_last_name"</span>)</span><br><span class="line">c.String(http.StatusOK, <span class="string">"%s %s"</span>, fristName, lastName)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="POST-Request-Parameters-Body-Value"><a href="#POST-Request-Parameters-Body-Value" class="headerlink" title="POST Request Parameters (Body Value)"></a>POST Request Parameters (Body Value)</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"bytes"</span></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.POST(<span class="string">"/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">body, err := ioutil.ReadAll(c.Request.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(http.StatusBadRequest, err.Error())</span><br><span class="line">c.Abort()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//c.String(http.StatusOK,string(body)) //传入json</span></span><br><span class="line"></span><br><span class="line">c.Request.Body = ioutil.NopCloser(bytes.NewBuffer(body))</span><br><span class="line">firstName := c.PostForm(<span class="string">"first_name"</span>)</span><br><span class="line">lastName := c.DefaultPostForm(<span class="string">"last_name"</span>, <span class="string">"default_last_name"</span>)</span><br><span class="line">c.String(http.StatusOK, <span class="string">"%s %s %s"</span>, firstName, lastName, <span class="keyword">string</span>(body))</span><br><span class="line">&#125;)</span><br><span class="line">r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Binding-Parameters-to-Structs"><a href="#Binding-Parameters-to-Structs" class="headerlink" title="Binding Parameters to Structs"></a>Binding Parameters to Structs</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`form:"name"`</span></span><br><span class="line">Address <span class="keyword">string</span> <span class="string">`form:"address"`</span></span><br><span class="line">Birthday time.Time <span class="string">`form:"birthday" time_format:"2006-01-02"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/testing"</span>, testing)</span><br><span class="line">r.POST(<span class="string">"/testing"</span>, testing)</span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testing</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line"><span class="keyword">var</span> person Person</span><br><span class="line"><span class="comment">// 根据请求的content-type来做不同的binding操作</span></span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBind(&amp;person); err == <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"%v"</span>, person)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"person binding error: %v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Request-Parameter-Validation"><a href="#Request-Parameter-Validation" class="headerlink" title="Request Parameter Validation"></a>Request Parameter Validation</h2><h4 id="Struct-Validation"><a href="#Struct-Validation" class="headerlink" title="Struct Validation"></a>Struct Validation</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Age <span class="keyword">int</span> <span class="string">`form:"age" binding:"required,gt=10"`</span></span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`form:"name" binding:"required"`</span></span><br><span class="line">Address <span class="keyword">string</span> <span class="string">`form:"address" binding:"required"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.GET(<span class="string">"/testing"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> person Person</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBind(&amp;person); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.String(<span class="number">500</span>, <span class="string">"%v"</span>, err)</span><br><span class="line">c.Abort()</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"%v"</span>, person)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> For more validator options, go to <a href="https://godoc.org/gopkg.in/go-playground/validator.v9" target="_blank" rel="noopener">package validator</a>.</p></blockquote><h4 id="Custom-Validation"><a href="#Custom-Validation" class="headerlink" title="Custom Validation"></a>Custom Validation</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin/binding"</span></span><br><span class="line"><span class="string">"github.com/go-playground/validator/v10"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Booking <span class="keyword">struct</span> &#123;</span><br><span class="line">CheckIn  time.Time <span class="string">`form:"check_in" binding:"required,bookabledate" time_format:"2006-01-02"`</span></span><br><span class="line">CheckOut time.Time <span class="string">`form:"check_out" binding:"required,gtfield=CheckIn" time_format:"2006-01-02"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Structure</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bookableDate</span><span class="params">(fl validator.FieldLevel)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> date, ok := fl.Field().Interface().(time.Time); ok &#123;</span><br><span class="line">today := time.Now()</span><br><span class="line"><span class="keyword">if</span> date.Unix() &gt; today.Unix() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> v, ok := binding.Validator.Engine().(*validator.Validate); ok &#123;</span><br><span class="line">v.RegisterValidation(<span class="string">"bookabledate"</span>, bookableDate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/bookable"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> b Booking</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBind(&amp;b); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, gin.H&#123;</span><br><span class="line"><span class="string">"error"</span>: err.Error(),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">"message"</span>: <span class="string">"ok"</span>,</span><br><span class="line"><span class="string">"booking"</span>: b,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><h4 id="Gin-Default-Middleware-Logger-and-Recovery"><a href="#Gin-Default-Middleware-Logger-and-Recovery" class="headerlink" title="Gin Default Middleware - Logger and Recovery"></a>Gin Default Middleware - Logger and Recovery</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"io"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">f, _ := os.Create(<span class="string">"middleware/gin.log"</span>)</span><br><span class="line">gin.DefaultWriter = io.MultiWriter(f)</span><br><span class="line">gin.DefaultErrorWriter = io.MultiWriter(f)</span><br><span class="line"></span><br><span class="line">r := gin.New()</span><br><span class="line">r.Use(gin.Logger(), gin.Recovery())</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/testing"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">name := c.DefaultQuery(<span class="string">"name"</span>, <span class="string">"default_name"</span>)</span><br><span class="line"><span class="built_in">panic</span>(<span class="string">"test panic"</span>)</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"%s"</span>, name)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Listen and serve on 0.0.0.0:8080</span></span><br><span class="line">r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Custom-Middleware"><a href="#Custom-Middleware" class="headerlink" title="Custom Middleware"></a>Custom Middleware</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IPAuthMiddleware</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">ipList := []<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">"127.0.0.2"</span>, <span class="comment">// "127.0.0.1 not in IP list"</span></span><br><span class="line">&#125;</span><br><span class="line">flag := <span class="literal">false</span></span><br><span class="line">clientIP := c.ClientIP()</span><br><span class="line"><span class="keyword">for</span> _, host := <span class="keyword">range</span> ipList &#123;</span><br><span class="line"><span class="keyword">if</span> clientIP == host &#123;</span><br><span class="line">flag = <span class="literal">true</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !flag &#123;</span><br><span class="line">c.String(<span class="number">401</span>, <span class="string">"%s not in IP list"</span>, clientIP)</span><br><span class="line">c.Abort()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.Use(IPAuthMiddleware())</span><br><span class="line">r.GET(<span class="string">"/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">"hello test"</span>)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
            <tag> gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pods in Kubernetes</title>
      <link href="/2020/07/01/Pods-in-Kubernetes/"/>
      <url>/2020/07/01/Pods-in-Kubernetes/</url>
      
        <content type="html"><![CDATA[<p>In docker, a container is the smallest unit, while in kubernetes, <strong>pods</strong> are the most basic building blocks. </p><p><em>Note: kubernetes can use container runtimes other than docker</em></p><p>A <strong>pod</strong> contains one or more containers, and each <strong>pod</strong> has:</p><ul><li>A single IP address</li><li>Share localhost</li><li>A shared IPC space</li><li>A shared network port range</li><li>Shared volumes</li></ul><blockquote><p>Everything in a <strong>pod</strong> is tightly coupled.</p><p>A <strong>pod</strong> is a way to represent a running process in a cluster.  (A container is also just a running process.)</p></blockquote><h2 id="Run-Pods-with-kubectl"><a href="#Run-Pods-with-kubectl" class="headerlink" title="Run Pods with kubectl"></a>Run Pods with kubectl</h2><p>Before doing anything, we must create a <strong>kubernetes cluster</strong> first:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ minikube start --vm-driver=virtualbox</span><br></pre></td></tr></table></figure><p>We can run a pod using the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run NAME --image=image [--env=<span class="string">"key=value"</span>] [--port=port] [--dry-run=server|client] [--overrides=inline-json] [--<span class="built_in">command</span>] -- [COMMAND] [args...]</span><br></pre></td></tr></table></figure><p>For example, you can a nginx server like following:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run nginx --image=nginx --generator <span class="string">"run-pod/v1"</span></span><br><span class="line">pod/nginx created</span><br></pre></td></tr></table></figure><p>We can verify that a pod was created by running:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods</span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx                   1/1     Running   0          4s</span><br></pre></td></tr></table></figure><p>We can ssh into minikube to confirm that a container created from the latest nignx image is running inside of the cluster:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ minikube ssh</span><br><span class="line">$ docker container ls -f ancestor=nginx</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">4f5ceb7b8921        nginx               <span class="string">"/docker-entrypoint.…"</span>   2 minutes ago       Up 2 minutes                            k8s_nginx_nginx_default_620758d2-c891-4ee4-a507-306257de8a74_0</span><br><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>We can also link our docker client with the docker server inside of minikube:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">eval</span> $(minikube docker-env)</span><br><span class="line">$ docker container ls -f ancestor=nginx</span><br></pre></td></tr></table></figure><p>To delete a pod, run:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete ([-f FILENAME] | [-k DIRECTORY] | TYPE [(NAME | -l label | --all)])</span><br></pre></td></tr></table></figure><p>So we can run:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete pod nginx</span><br><span class="line">pod <span class="string">"nginx"</span> deleted</span><br></pre></td></tr></table></figure><h3 id="Why-this-is-bad-practice"><a href="#Why-this-is-bad-practice" class="headerlink" title="Why this is bad practice?"></a>Why this is bad practice?</h3><p>In the above, we manually created a pod running ngnix image. This is just a simple application with only one node. <em>What if we have a complex application which needs thousands of nodes?</em> Creating all these nodes manually is very tedious and error-prone. Even if we created all these nodes, we can’t possibly reproduce this result easily or even correctly.</p><h4 id="Infrastructure-as-Code"><a href="#Infrastructure-as-Code" class="headerlink" title="Infrastructure as Code"></a>Infrastructure as Code</h4><p>Instead of running pods in an <strong>imperative</strong> way, as shown above, we should run them in a <strong>declarative</strong> way. We want to define all the pods we need in files and let kubernetes to manage the process of creating all these pods. This way, our infrastructure can be documented, just like code, so we can easily store, share, and reproduce it.</p>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> pods </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
